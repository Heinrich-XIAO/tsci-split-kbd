{"version":3,"sources":["../src/ConnectivityMap.ts"],"sourcesContent":["export class ConnectivityMap {\n  netMap: Record<string, string[]>\n\n  idToNetMap: Record<string, string>\n\n  constructor(netMap: Record<string, string[]>) {\n    this.netMap = netMap\n    this.idToNetMap = {}\n    for (const [netId, ids] of Object.entries(netMap)) {\n      for (const id of ids) {\n        this.idToNetMap[id] = netId\n      }\n    }\n  }\n\n  addConnections(connections: string[][]) {\n    for (const connection of connections) {\n      const existingNets = new Set<string>()\n\n      // Find all existing nets for the connection\n      for (const id of connection) {\n        const existingNetId = this.idToNetMap[id]\n        if (existingNetId) {\n          existingNets.add(existingNetId)\n        }\n      }\n\n      let targetNetId: string\n\n      if (existingNets.size === 0) {\n        // If no existing nets found, create a new one\n        targetNetId = `connectivity_net${Object.keys(this.netMap).length}`\n        this.netMap[targetNetId] = []\n      } else if (existingNets.size === 1) {\n        // If only one existing net found, use it\n        targetNetId =\n          existingNets.values().next().value ??\n          `connectivity_net${Object.keys(this.netMap).length}`\n      } else {\n        // If multiple nets found, merge them\n        targetNetId =\n          existingNets.values().next().value ??\n          `connectivity_net${Object.keys(this.netMap).length}`\n        for (const netId of existingNets) {\n          if (netId !== targetNetId) {\n            const targetNet = this.netMap[targetNetId]\n            const sourceNet = this.netMap[netId]\n            if (targetNet && sourceNet) {\n              targetNet.push(...sourceNet)\n\n              // we could delete the net, but setting it to reference the other net\n              // will make sure any usage of the old netId will still work\n              this.netMap[netId] = targetNet\n              for (const id of targetNet) {\n                this.idToNetMap[id] = targetNetId\n              }\n            }\n          }\n        }\n      }\n\n      // Add all ids to the target net\n      for (const id of connection) {\n        const targetNet = this.netMap[targetNetId]\n        if (targetNet && !targetNet.includes(id)) {\n          targetNet.push(id)\n        }\n        this.idToNetMap[id] = targetNetId\n      }\n    }\n  }\n\n  getIdsConnectedToNet(netId: string): string[] {\n    return this.netMap[netId] || []\n  }\n\n  getNetConnectedToId(id: string): string | undefined {\n    return this.idToNetMap[id]\n  }\n\n  areIdsConnected(id1: string, id2: string): boolean {\n    if (id1 === id2) return true\n    const netId1 = this.getNetConnectedToId(id1)\n    if (!netId1) return false\n    const netId2 = this.getNetConnectedToId(id2)\n    if (!netId2) return false\n    return netId1 === netId2 || netId2 === id1 || netId2 === id1\n  }\n\n  areAllIdsConnected(ids: string[]): boolean {\n    if (ids.length === 0) return true\n    const netId = this.getNetConnectedToId(ids[0]!)\n    if (!netId) return false\n\n    for (const id of ids) {\n      const nextNetId = this.getNetConnectedToId(id)\n      if (nextNetId === undefined) {\n        return false\n      }\n      if (nextNetId !== netId) {\n        return false\n      }\n    }\n    return true\n  }\n}\n"],"mappings":";AAAO,IAAM,kBAAN,MAAsB;AAAA,EAC3B;AAAA,EAEA;AAAA,EAEA,YAAY,QAAkC;AAC5C,SAAK,SAAS;AACd,SAAK,aAAa,CAAC;AACnB,eAAW,CAAC,OAAO,GAAG,KAAK,OAAO,QAAQ,MAAM,GAAG;AACjD,iBAAW,MAAM,KAAK;AACpB,aAAK,WAAW,EAAE,IAAI;AAAA,MACxB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,eAAe,aAAyB;AACtC,eAAW,cAAc,aAAa;AACpC,YAAM,eAAe,oBAAI,IAAY;AAGrC,iBAAW,MAAM,YAAY;AAC3B,cAAM,gBAAgB,KAAK,WAAW,EAAE;AACxC,YAAI,eAAe;AACjB,uBAAa,IAAI,aAAa;AAAA,QAChC;AAAA,MACF;AAEA,UAAI;AAEJ,UAAI,aAAa,SAAS,GAAG;AAE3B,sBAAc,mBAAmB,OAAO,KAAK,KAAK,MAAM,EAAE,MAAM;AAChE,aAAK,OAAO,WAAW,IAAI,CAAC;AAAA,MAC9B,WAAW,aAAa,SAAS,GAAG;AAElC,sBACE,aAAa,OAAO,EAAE,KAAK,EAAE,SAC7B,mBAAmB,OAAO,KAAK,KAAK,MAAM,EAAE,MAAM;AAAA,MACtD,OAAO;AAEL,sBACE,aAAa,OAAO,EAAE,KAAK,EAAE,SAC7B,mBAAmB,OAAO,KAAK,KAAK,MAAM,EAAE,MAAM;AACpD,mBAAW,SAAS,cAAc;AAChC,cAAI,UAAU,aAAa;AACzB,kBAAM,YAAY,KAAK,OAAO,WAAW;AACzC,kBAAM,YAAY,KAAK,OAAO,KAAK;AACnC,gBAAI,aAAa,WAAW;AAC1B,wBAAU,KAAK,GAAG,SAAS;AAI3B,mBAAK,OAAO,KAAK,IAAI;AACrB,yBAAW,MAAM,WAAW;AAC1B,qBAAK,WAAW,EAAE,IAAI;AAAA,cACxB;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAGA,iBAAW,MAAM,YAAY;AAC3B,cAAM,YAAY,KAAK,OAAO,WAAW;AACzC,YAAI,aAAa,CAAC,UAAU,SAAS,EAAE,GAAG;AACxC,oBAAU,KAAK,EAAE;AAAA,QACnB;AACA,aAAK,WAAW,EAAE,IAAI;AAAA,MACxB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,qBAAqB,OAAyB;AAC5C,WAAO,KAAK,OAAO,KAAK,KAAK,CAAC;AAAA,EAChC;AAAA,EAEA,oBAAoB,IAAgC;AAClD,WAAO,KAAK,WAAW,EAAE;AAAA,EAC3B;AAAA,EAEA,gBAAgB,KAAa,KAAsB;AACjD,QAAI,QAAQ,IAAK,QAAO;AACxB,UAAM,SAAS,KAAK,oBAAoB,GAAG;AAC3C,QAAI,CAAC,OAAQ,QAAO;AACpB,UAAM,SAAS,KAAK,oBAAoB,GAAG;AAC3C,QAAI,CAAC,OAAQ,QAAO;AACpB,WAAO,WAAW,UAAU,WAAW,OAAO,WAAW;AAAA,EAC3D;AAAA,EAEA,mBAAmB,KAAwB;AACzC,QAAI,IAAI,WAAW,EAAG,QAAO;AAC7B,UAAM,QAAQ,KAAK,oBAAoB,IAAI,CAAC,CAAE;AAC9C,QAAI,CAAC,MAAO,QAAO;AAEnB,eAAW,MAAM,KAAK;AACpB,YAAM,YAAY,KAAK,oBAAoB,EAAE;AAC7C,UAAI,cAAc,QAAW;AAC3B,eAAO;AAAA,MACT;AACA,UAAI,cAAc,OAAO;AACvB,eAAO;AAAA,MACT;AAAA,IACF;AACA,WAAO;AAAA,EACT;AACF;","names":[]}