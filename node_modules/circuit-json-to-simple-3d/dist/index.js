// lib/index.ts
import { cju } from "@tscircuit/circuit-json-util";
import { renderScene } from "@tscircuit/simple-3d-svg";

// lib/getDefaultCameraForPcbBoard.ts
function getDefaultCameraForPcbBoard(pcbBoard, anglePreset = "angle1", defaultZoomMultiplier) {
  const w = pcbBoard.width;
  const h = pcbBoard.height;
  const cx = pcbBoard.center?.x || 0;
  const cz = pcbBoard.center?.y || 0;
  const boardSize = Math.max(w, h);
  let baseDist = boardSize * 1.5;
  let effectiveZoomLevel;
  if (defaultZoomMultiplier !== void 0) {
    if (defaultZoomMultiplier > 0) {
      effectiveZoomLevel = defaultZoomMultiplier;
      baseDist = baseDist / effectiveZoomLevel;
    }
  }
  const dist = baseDist;
  let position;
  if (anglePreset === "angle1") {
    position = { x: cx - dist, y: dist, z: cz - dist };
  } else if (anglePreset === "angle2") {
    position = { x: cx + dist, y: dist, z: cz - dist };
  } else if (anglePreset === "left") {
    position = { x: cx - dist, y: 0, z: cz };
  } else if (anglePreset === "right") {
    position = { x: cx + dist, y: 0, z: cz };
  } else if (anglePreset === "left-raised") {
    position = { x: cx - dist, y: dist, z: cz };
  } else if (anglePreset === "right-raised") {
    position = { x: cx + dist, y: dist, z: cz };
  } else {
    throw new Error(`Unknown angle preset: ${anglePreset}`);
  }
  const focalLength = effectiveZoomLevel ? Math.max(1, 2 * effectiveZoomLevel) : 2;
  return {
    position,
    lookAt: { x: cx, y: 0, z: cz },
    focalLength
  };
}

// lib/getDefaultCameraForComponents.ts
function getDefaultCameraForComponents(components, anglePreset = "angle1", defaultZoomMultiplier) {
  if (components.length === 0) {
    return {
      position: { x: 10, y: 10, z: 10 },
      lookAt: { x: 0, y: 0, z: 0 },
      focalLength: 2
    };
  }
  let minX = Number.POSITIVE_INFINITY;
  let maxX = Number.NEGATIVE_INFINITY;
  let minZ = Number.POSITIVE_INFINITY;
  let maxZ = Number.NEGATIVE_INFINITY;
  for (const comp of components) {
    const halfWidth = comp.width / 2;
    const halfHeight = comp.height / 2;
    minX = Math.min(minX, comp.center.x - halfWidth);
    maxX = Math.max(maxX, comp.center.x + halfWidth);
    minZ = Math.min(minZ, comp.center.y - halfHeight);
    maxZ = Math.max(maxZ, comp.center.y + halfHeight);
  }
  const cx = (minX + maxX) / 2;
  const cz = (minZ + maxZ) / 2;
  const w = maxX - minX;
  const h = maxZ - minZ;
  const componentSize = Math.max(w, h, 5);
  let baseDist = componentSize * 1.5;
  let effectiveZoomLevel;
  if (defaultZoomMultiplier !== void 0) {
    if (defaultZoomMultiplier > 0) {
      effectiveZoomLevel = defaultZoomMultiplier;
      baseDist = baseDist / effectiveZoomLevel;
    }
  }
  const dist = baseDist;
  let position;
  if (anglePreset === "angle1") {
    position = { x: cx - dist, y: dist, z: cz - dist };
  } else if (anglePreset === "angle2") {
    position = { x: cx + dist, y: dist, z: cz - dist };
  } else if (anglePreset === "left") {
    position = { x: cx - dist, y: 0, z: cz };
  } else if (anglePreset === "right") {
    position = { x: cx + dist, y: 0, z: cz };
  } else if (anglePreset === "left-raised") {
    position = { x: cx - dist, y: dist, z: cz };
  } else if (anglePreset === "right-raised") {
    position = { x: cx + dist, y: dist, z: cz };
  } else {
    throw new Error(`Unknown angle preset: ${anglePreset}`);
  }
  const focalLength = effectiveZoomLevel ? Math.max(1, 2 * effectiveZoomLevel) : 2;
  return {
    position,
    lookAt: { x: cx, y: 0, z: cz },
    focalLength
  };
}

// lib/index.ts
import { convertCircuitJsonToPcbSvg } from "circuit-to-svg";

// lib/utils/get-background-color-from-options.ts
import Color2 from "color";

// lib/utils/is-valid-color.ts
import Color from "color";
var isValidColor = (color) => {
  try {
    Color(color);
    return true;
  } catch {
    return false;
  }
};

// lib/utils/get-background-color-from-options.ts
function getColorFromBackgroundOptions(background) {
  if (!background) return "white";
  if (background.color) {
    if (background.opacity !== void 0) {
      try {
        const color = Color2(background.color);
        const opacity = Math.max(0, Math.min(1, background.opacity));
        return color.alpha(opacity).string();
      } catch {
        return "white";
      }
    }
    if (isValidColor(background.color)) {
      return background.color;
    }
    return "white";
  }
  return "white";
}

// lib/index.ts
var convertRotationFromCadRotation = (rot) => {
  return {
    x: rot.x * Math.PI / 180 - Math.PI / 2,
    y: rot.y * Math.PI / 180,
    z: rot.z * Math.PI / 180
  };
};
async function convertCircuitJsonToSimple3dScene(circuitJson, opts = {}) {
  const db = cju(circuitJson);
  const boxes = [];
  const pcbBoard = db.pcb_board.list()[0];
  const DEFAULT_COMP_HEIGHT = 2;
  const DEFAULT_BOARD_THICKNESS = 1.4;
  const cadComponents = db.cad_component?.list?.() ?? [];
  const pcbComponentIdsWith3d = /* @__PURE__ */ new Set();
  for (const cad of cadComponents) {
    const { model_stl_url, model_obj_url } = cad;
    if (!model_stl_url && !model_obj_url) continue;
    pcbComponentIdsWith3d.add(cad.pcb_component_id);
    const pcbComp = db.pcb_component.get(cad.pcb_component_id);
    const DEFAULT_SIZE = 2;
    const size = cad.size ?? (pcbComp ? { x: pcbComp.width, y: DEFAULT_COMP_HEIGHT, z: pcbComp.height } : { x: DEFAULT_SIZE, y: DEFAULT_SIZE, z: DEFAULT_SIZE });
    const boardThickness = pcbBoard?.thickness ?? DEFAULT_BOARD_THICKNESS;
    const center = cad.position ? { x: cad.position.x, y: cad.position.z, z: cad.position.y } : {
      x: pcbComp?.center.x ?? 0,
      y: boardThickness / 2 + size.y / 2,
      z: pcbComp?.center.y ?? 0
    };
    boxes.push({
      center,
      size,
      color: !(model_obj_url || model_stl_url) ? "rgba(128,128,128,0.5)" : void 0,
      // used only when model fails to load
      // STL / OBJ support
      ...model_stl_url ? {
        stlUrl: model_stl_url,
        scaleStlToBox: false,
        centerModel: true,
        drawBoundingBox: opts.showBoundingBoxes ?? false
      } : {},
      ...model_obj_url ? {
        objUrl: model_obj_url,
        scaleObjToBox: false,
        centerModel: true,
        drawBoundingBox: opts.showBoundingBoxes ?? false
      } : {},
      // Forward any explicit rotation/position overrides from the CAD record
      ...cad.rotation ? {
        // stlRotation: convertRotation(cad.rotation),
        objRotation: convertRotationFromCadRotation(cad.rotation)
      } : {}
    });
  }
  let camera = opts.camera;
  if (!camera) {
    if (pcbBoard) {
      camera = getDefaultCameraForPcbBoard(
        pcbBoard,
        opts.anglePreset ?? "angle1",
        opts.defaultZoomMultiplier
      );
    } else {
      const pcbComponents = db.pcb_component.list();
      camera = getDefaultCameraForComponents(
        pcbComponents,
        opts.anglePreset ?? "angle1",
        opts.defaultZoomMultiplier
      );
    }
  }
  if (!camera.focalLength) {
    camera.focalLength = 1;
  }
  if (pcbBoard) {
    const pcbTopSvg = convertCircuitJsonToPcbSvg(circuitJson, {
      layer: "top",
      matchBoardAspectRatio: true,
      backgroundColor: "transparent",
      drawPaddingOutsideBoard: false,
      colorOverrides: {
        copper: {
          top: "#ffe066",
          bottom: "#ffe066"
        },
        drill: "rgba(0,0,0,0.5)"
      }
    }).replace("<svg", "<svg transform='scale(1, -1)'");
    boxes.push({
      center: {
        x: pcbBoard.center.x,
        y: 0,
        z: pcbBoard.center.y
      },
      size: {
        x: pcbBoard.width,
        y: pcbBoard.thickness,
        z: pcbBoard.height
      },
      faceImages: {
        top: `data:image/svg+xml;base64,${btoa(pcbTopSvg)}`
      },
      projectionSubdivision: 10,
      color: "rgba(0,140,0,0.8)"
    });
  }
  for (const comp of db.pcb_component.list()) {
    if (pcbComponentIdsWith3d.has(comp.pcb_component_id)) continue;
    const sourceComponent = db.source_component.get(comp.source_component_id);
    const compHeight = Math.min(
      Math.min(comp.width, comp.height),
      DEFAULT_COMP_HEIGHT
    );
    const boardThickness = pcbBoard?.thickness ?? DEFAULT_BOARD_THICKNESS;
    boxes.push({
      center: {
        x: comp.center.x,
        y: boardThickness / 2 + compHeight / 2,
        z: comp.center.y
      },
      size: {
        x: comp.width,
        y: compHeight,
        z: comp.height
      },
      color: "rgba(128,128,128,0.5)",
      topLabel: sourceComponent?.name ?? "?",
      topLabelColor: "white"
    });
  }
  return { boxes, camera };
}
async function convertCircuitJsonToSimple3dSvg(circuitJson, opts = {}) {
  const backgroundColor = getColorFromBackgroundOptions(opts.background);
  const renderOptions = {
    backgroundColor,
    showGrid: opts.showGrid ?? false,
    showOrigin: opts.showOrigin ?? false,
    showAxes: opts.showAxes ?? false
  };
  if (opts.width) renderOptions.width = opts.width;
  if (opts.height) renderOptions.height = opts.height;
  const scene = await convertCircuitJsonToSimple3dScene(circuitJson, opts);
  return await renderScene(scene, {
    ...renderOptions
  });
}
export {
  convertCircuitJsonToSimple3dScene,
  convertCircuitJsonToSimple3dSvg
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vbGliL2luZGV4LnRzIiwgIi4uL2xpYi9nZXREZWZhdWx0Q2FtZXJhRm9yUGNiQm9hcmQudHMiLCAiLi4vbGliL2dldERlZmF1bHRDYW1lcmFGb3JDb21wb25lbnRzLnRzIiwgIi4uL2xpYi91dGlscy9nZXQtYmFja2dyb3VuZC1jb2xvci1mcm9tLW9wdGlvbnMudHMiLCAiLi4vbGliL3V0aWxzL2lzLXZhbGlkLWNvbG9yLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgdHlwZSB7IENpcmN1aXRKc29uIH0gZnJvbSBcImNpcmN1aXQtanNvblwiXG5pbXBvcnQgdHlwZSB7IENhZENvbXBvbmVudCB9IGZyb20gXCJjaXJjdWl0LWpzb25cIlxuaW1wb3J0IHsgY2p1IH0gZnJvbSBcIkB0c2NpcmN1aXQvY2lyY3VpdC1qc29uLXV0aWxcIlxuaW1wb3J0IHsgcmVuZGVyU2NlbmUsIHR5cGUgQm94LCB0eXBlIENhbWVyYSB9IGZyb20gXCJAdHNjaXJjdWl0L3NpbXBsZS0zZC1zdmdcIlxuaW1wb3J0IHtcbiAgZ2V0RGVmYXVsdENhbWVyYUZvclBjYkJvYXJkLFxuICB0eXBlIEFuZ2xlUHJlc2V0LFxufSBmcm9tIFwiLi9nZXREZWZhdWx0Q2FtZXJhRm9yUGNiQm9hcmRcIlxuaW1wb3J0IHsgZ2V0RGVmYXVsdENhbWVyYUZvckNvbXBvbmVudHMgfSBmcm9tIFwiLi9nZXREZWZhdWx0Q2FtZXJhRm9yQ29tcG9uZW50c1wiXG5pbXBvcnQgeyBjb252ZXJ0Q2lyY3VpdEpzb25Ub1BjYlN2ZyB9IGZyb20gXCJjaXJjdWl0LXRvLXN2Z1wiXG5pbXBvcnQgdHlwZSB7XG4gIFNpbXBsZTNkU3ZnT3B0aW9ucyxcbiAgQmFja2dyb3VuZE9wdGlvbnMsXG4gIFJlbmRlclNjZW5lT3B0aW9ucyxcbn0gZnJvbSBcIi4vdHlwZXNcIlxuaW1wb3J0IHsgZ2V0Q29sb3JGcm9tQmFja2dyb3VuZE9wdGlvbnMgfSBmcm9tIFwiLi91dGlscy9nZXQtYmFja2dyb3VuZC1jb2xvci1mcm9tLW9wdGlvbnNcIlxuXG5jb25zdCBjb252ZXJ0Um90YXRpb25Gcm9tQ2FkUm90YXRpb24gPSAocm90OiB7XG4gIHg6IG51bWJlclxuICB5OiBudW1iZXJcbiAgejogbnVtYmVyXG59KSA9PiB7XG4gIHJldHVybiB7XG4gICAgeDogKHJvdC54ICogTWF0aC5QSSkgLyAxODAgLSBNYXRoLlBJIC8gMixcbiAgICB5OiAocm90LnkgKiBNYXRoLlBJKSAvIDE4MCxcbiAgICB6OiAocm90LnogKiBNYXRoLlBJKSAvIDE4MCxcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29udmVydENpcmN1aXRKc29uVG9TaW1wbGUzZFNjZW5lKFxuICBjaXJjdWl0SnNvbjogQ2lyY3VpdEpzb24sXG4gIG9wdHM6IFNpbXBsZTNkU3ZnT3B0aW9ucyA9IHt9LFxuKTogUHJvbWlzZTx7IGJveGVzOiBCb3hbXTsgY2FtZXJhOiBhbnkgfT4ge1xuICBjb25zdCBkYiA9IGNqdShjaXJjdWl0SnNvbilcbiAgY29uc3QgYm94ZXM6IEJveFtdID0gW11cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gRXNzZW50aWFsIGJvYXJkLWxldmVsIGNvbnN0YW50cyBcdTIwMTMgbmVlZGVkIGJlZm9yZSB3ZSBjcmVhdGUgYW55IEJveCBvYmplY3RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdCBwY2JCb2FyZCA9IGRiLnBjYl9ib2FyZC5saXN0KClbMF1cblxuICAvLyBEZWZhdWx0IGV4dHJ1c2lvbiAoaGVpZ2h0KSBmb3IgZ2VuZXJpYyBQQ0IgY29tcG9uZW50cyAvIGZhbGxiYWNrIGN1YmVzXG4gIGNvbnN0IERFRkFVTFRfQ09NUF9IRUlHSFQgPSAyXG5cbiAgLy8gRGVmYXVsdCBib2FyZCB0aGlja25lc3MgZm9yIHdoZW4gdGhlcmUncyBubyBQQ0IgYm9hcmRcbiAgY29uc3QgREVGQVVMVF9CT0FSRF9USElDS05FU1MgPSAxLjRcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQWRkIDMtRCBDQUQgbW9kZWxzIChTVEwgLyBPQkopIHRoYXQgYXJlIGRlc2NyaWJlZCBieSBjYWRfY29tcG9uZW50IHJlY29yZHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0IGNhZENvbXBvbmVudHM6IENhZENvbXBvbmVudFtdID0gKGRiLmNhZF9jb21wb25lbnQ/Lmxpc3Q/LigpID8/XG4gICAgW10pIGFzIGFueVxuICBjb25zdCBwY2JDb21wb25lbnRJZHNXaXRoM2QgPSBuZXcgU2V0PHN0cmluZz4oKVxuXG4gIGZvciAoY29uc3QgY2FkIG9mIGNhZENvbXBvbmVudHMpIHtcbiAgICBjb25zdCB7IG1vZGVsX3N0bF91cmwsIG1vZGVsX29ial91cmwgfSA9IGNhZFxuICAgIGlmICghbW9kZWxfc3RsX3VybCAmJiAhbW9kZWxfb2JqX3VybCkgY29udGludWUgLy8gbm90aGluZyB3ZSBjYW4gcmVuZGVyXG5cbiAgICAvLyBSZW1lbWJlciB3aGljaCBwY2JfY29tcG9uZW50IGFscmVhZHkgaGFzIGEgMy1EIG1vZGVsIHNvIHdlIGNhbiBza2lwIHRoZVxuICAgIC8vIGdlbmVyaWMgXCJncmF5IGN1YmVcIiBsYXRlclxuICAgIHBjYkNvbXBvbmVudElkc1dpdGgzZC5hZGQoY2FkLnBjYl9jb21wb25lbnRfaWQpXG5cbiAgICAvLyBTaXplIFx1MjAxMyBwcmVmZXIgdGhlIG9uZSBnaXZlbiBvbiB0aGUgY2FkX2NvbXBvbmVudCwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0b1xuICAgIC8vIHRoZSBwY2JfY29tcG9uZW50IGZvb3RwcmludCwgZmluYWxseSB0byBhIHNtYWxsIGRlZmF1bHQgY3ViZVxuICAgIGNvbnN0IHBjYkNvbXAgPSBkYi5wY2JfY29tcG9uZW50LmdldChjYWQucGNiX2NvbXBvbmVudF9pZClcbiAgICBjb25zdCBERUZBVUxUX1NJWkUgPSAyXG4gICAgY29uc3Qgc2l6ZSA9XG4gICAgICBjYWQuc2l6ZSA/P1xuICAgICAgKHBjYkNvbXBcbiAgICAgICAgPyB7IHg6IHBjYkNvbXAud2lkdGgsIHk6IERFRkFVTFRfQ09NUF9IRUlHSFQsIHo6IHBjYkNvbXAuaGVpZ2h0IH1cbiAgICAgICAgOiB7IHg6IERFRkFVTFRfU0laRSwgeTogREVGQVVMVF9TSVpFLCB6OiBERUZBVUxUX1NJWkUgfSlcblxuICAgIC8vIFBvc2l0aW9uIFx1MjAxMyB1c2UgdGhlIGV4cGxpY2l0IDMtRCBwb3NpdGlvbiB3aGVuIHByb3ZpZGVkLCBvdGhlcndpc2UgcHV0IHRoZVxuICAgIC8vIG1vZGVsIG9uIHRvcCBvZiB0aGUgUENCIGF0IHRoZSBwY2JfY29tcG9uZW50IGNlbnRyZVxuICAgIGNvbnN0IGJvYXJkVGhpY2tuZXNzID0gcGNiQm9hcmQ/LnRoaWNrbmVzcyA/PyBERUZBVUxUX0JPQVJEX1RISUNLTkVTU1xuICAgIGNvbnN0IGNlbnRlciA9IGNhZC5wb3NpdGlvblxuICAgICAgPyB7IHg6IGNhZC5wb3NpdGlvbi54LCB5OiBjYWQucG9zaXRpb24ueiwgejogY2FkLnBvc2l0aW9uLnkgfVxuICAgICAgOiB7XG4gICAgICAgICAgeDogcGNiQ29tcD8uY2VudGVyLnggPz8gMCxcbiAgICAgICAgICB5OiBib2FyZFRoaWNrbmVzcyAvIDIgKyBzaXplLnkgLyAyLFxuICAgICAgICAgIHo6IHBjYkNvbXA/LmNlbnRlci55ID8/IDAsXG4gICAgICAgIH1cblxuICAgIGJveGVzLnB1c2goe1xuICAgICAgY2VudGVyLFxuICAgICAgc2l6ZSxcbiAgICAgIGNvbG9yOiAhKG1vZGVsX29ial91cmwgfHwgbW9kZWxfc3RsX3VybClcbiAgICAgICAgPyBcInJnYmEoMTI4LDEyOCwxMjgsMC41KVwiXG4gICAgICAgIDogdW5kZWZpbmVkLCAvLyB1c2VkIG9ubHkgd2hlbiBtb2RlbCBmYWlscyB0byBsb2FkXG4gICAgICAvLyBTVEwgLyBPQkogc3VwcG9ydFxuICAgICAgLi4uKG1vZGVsX3N0bF91cmxcbiAgICAgICAgPyB7XG4gICAgICAgICAgICBzdGxVcmw6IG1vZGVsX3N0bF91cmwsXG4gICAgICAgICAgICBzY2FsZVN0bFRvQm94OiBmYWxzZSxcbiAgICAgICAgICAgIGNlbnRlck1vZGVsOiB0cnVlLFxuICAgICAgICAgICAgZHJhd0JvdW5kaW5nQm94OiBvcHRzLnNob3dCb3VuZGluZ0JveGVzID8/IGZhbHNlLFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7fSksXG4gICAgICAuLi4obW9kZWxfb2JqX3VybFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIG9ialVybDogbW9kZWxfb2JqX3VybCxcbiAgICAgICAgICAgIHNjYWxlT2JqVG9Cb3g6IGZhbHNlLFxuICAgICAgICAgICAgY2VudGVyTW9kZWw6IHRydWUsXG4gICAgICAgICAgICBkcmF3Qm91bmRpbmdCb3g6IG9wdHMuc2hvd0JvdW5kaW5nQm94ZXMgPz8gZmFsc2UsXG4gICAgICAgICAgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIC8vIEZvcndhcmQgYW55IGV4cGxpY2l0IHJvdGF0aW9uL3Bvc2l0aW9uIG92ZXJyaWRlcyBmcm9tIHRoZSBDQUQgcmVjb3JkXG4gICAgICAuLi4oY2FkLnJvdGF0aW9uXG4gICAgICAgID8ge1xuICAgICAgICAgICAgLy8gc3RsUm90YXRpb246IGNvbnZlcnRSb3RhdGlvbihjYWQucm90YXRpb24pLFxuICAgICAgICAgICAgb2JqUm90YXRpb246IGNvbnZlcnRSb3RhdGlvbkZyb21DYWRSb3RhdGlvbihjYWQucm90YXRpb24pLFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7fSksXG4gICAgfSBzYXRpc2ZpZXMgQm94KVxuICB9XG5cbiAgbGV0IGNhbWVyYTogQ2FtZXJhIHwgdW5kZWZpbmVkID0gb3B0cy5jYW1lcmFcblxuICBpZiAoIWNhbWVyYSkge1xuICAgIGlmIChwY2JCb2FyZCkge1xuICAgICAgY2FtZXJhID0gZ2V0RGVmYXVsdENhbWVyYUZvclBjYkJvYXJkKFxuICAgICAgICBwY2JCb2FyZCxcbiAgICAgICAgb3B0cy5hbmdsZVByZXNldCA/PyBcImFuZ2xlMVwiLFxuICAgICAgICBvcHRzLmRlZmF1bHRab29tTXVsdGlwbGllcixcbiAgICAgIClcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXNlIGNvbXBvbmVudC1iYXNlZCBjYW1lcmEgZm9yIHN0YW5kYWxvbmUgY29tcG9uZW50c1xuICAgICAgY29uc3QgcGNiQ29tcG9uZW50cyA9IGRiLnBjYl9jb21wb25lbnQubGlzdCgpXG4gICAgICBjYW1lcmEgPSBnZXREZWZhdWx0Q2FtZXJhRm9yQ29tcG9uZW50cyhcbiAgICAgICAgcGNiQ29tcG9uZW50cyxcbiAgICAgICAgb3B0cy5hbmdsZVByZXNldCA/PyBcImFuZ2xlMVwiLFxuICAgICAgICBvcHRzLmRlZmF1bHRab29tTXVsdGlwbGllcixcbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBpZiAoIWNhbWVyYS5mb2NhbExlbmd0aCkge1xuICAgIGNhbWVyYS5mb2NhbExlbmd0aCA9IDFcbiAgfVxuXG4gIGlmIChwY2JCb2FyZCkge1xuICAgIGNvbnN0IHBjYlRvcFN2ZyA9IGNvbnZlcnRDaXJjdWl0SnNvblRvUGNiU3ZnKGNpcmN1aXRKc29uLCB7XG4gICAgICBsYXllcjogXCJ0b3BcIixcbiAgICAgIG1hdGNoQm9hcmRBc3BlY3RSYXRpbzogdHJ1ZSxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgZHJhd1BhZGRpbmdPdXRzaWRlQm9hcmQ6IGZhbHNlLFxuICAgICAgY29sb3JPdmVycmlkZXM6IHtcbiAgICAgICAgY29wcGVyOiB7XG4gICAgICAgICAgdG9wOiBcIiNmZmUwNjZcIixcbiAgICAgICAgICBib3R0b206IFwiI2ZmZTA2NlwiLFxuICAgICAgICB9LFxuICAgICAgICBkcmlsbDogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgIH0sXG4gICAgfSkucmVwbGFjZShcIjxzdmdcIiwgXCI8c3ZnIHRyYW5zZm9ybT0nc2NhbGUoMSwgLTEpJ1wiKVxuXG4gICAgYm94ZXMucHVzaCh7XG4gICAgICBjZW50ZXI6IHtcbiAgICAgICAgeDogcGNiQm9hcmQuY2VudGVyLngsXG4gICAgICAgIHk6IDAsXG4gICAgICAgIHo6IHBjYkJvYXJkLmNlbnRlci55LFxuICAgICAgfSxcbiAgICAgIHNpemU6IHtcbiAgICAgICAgeDogcGNiQm9hcmQud2lkdGgsXG4gICAgICAgIHk6IHBjYkJvYXJkLnRoaWNrbmVzcyxcbiAgICAgICAgejogcGNiQm9hcmQuaGVpZ2h0LFxuICAgICAgfSxcbiAgICAgIGZhY2VJbWFnZXM6IHtcbiAgICAgICAgdG9wOiBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke2J0b2EocGNiVG9wU3ZnKX1gLFxuICAgICAgfSxcbiAgICAgIHByb2plY3Rpb25TdWJkaXZpc2lvbjogMTAsXG4gICAgICBjb2xvcjogXCJyZ2JhKDAsMTQwLDAsMC44KVwiLFxuICAgIH0pXG4gIH1cblxuICBmb3IgKGNvbnN0IGNvbXAgb2YgZGIucGNiX2NvbXBvbmVudC5saXN0KCkpIHtcbiAgICBpZiAocGNiQ29tcG9uZW50SWRzV2l0aDNkLmhhcyhjb21wLnBjYl9jb21wb25lbnRfaWQpKSBjb250aW51ZVxuICAgIGNvbnN0IHNvdXJjZUNvbXBvbmVudCA9IGRiLnNvdXJjZV9jb21wb25lbnQuZ2V0KGNvbXAuc291cmNlX2NvbXBvbmVudF9pZClcbiAgICBjb25zdCBjb21wSGVpZ2h0ID0gTWF0aC5taW4oXG4gICAgICBNYXRoLm1pbihjb21wLndpZHRoLCBjb21wLmhlaWdodCksXG4gICAgICBERUZBVUxUX0NPTVBfSEVJR0hULFxuICAgIClcbiAgICBjb25zdCBib2FyZFRoaWNrbmVzcyA9IHBjYkJvYXJkPy50aGlja25lc3MgPz8gREVGQVVMVF9CT0FSRF9USElDS05FU1NcbiAgICBib3hlcy5wdXNoKHtcbiAgICAgIGNlbnRlcjoge1xuICAgICAgICB4OiBjb21wLmNlbnRlci54LFxuICAgICAgICB5OiBib2FyZFRoaWNrbmVzcyAvIDIgKyBjb21wSGVpZ2h0IC8gMixcbiAgICAgICAgejogY29tcC5jZW50ZXIueSxcbiAgICAgIH0sXG4gICAgICBzaXplOiB7XG4gICAgICAgIHg6IGNvbXAud2lkdGgsXG4gICAgICAgIHk6IGNvbXBIZWlnaHQsXG4gICAgICAgIHo6IGNvbXAuaGVpZ2h0LFxuICAgICAgfSxcbiAgICAgIGNvbG9yOiBcInJnYmEoMTI4LDEyOCwxMjgsMC41KVwiLFxuICAgICAgdG9wTGFiZWw6IHNvdXJjZUNvbXBvbmVudD8ubmFtZSA/PyBcIj9cIixcbiAgICAgIHRvcExhYmVsQ29sb3I6IFwid2hpdGVcIixcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIHsgYm94ZXMsIGNhbWVyYSB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb252ZXJ0Q2lyY3VpdEpzb25Ub1NpbXBsZTNkU3ZnKFxuICBjaXJjdWl0SnNvbjogQ2lyY3VpdEpzb24sXG4gIG9wdHM6IFNpbXBsZTNkU3ZnT3B0aW9ucyA9IHt9LFxuKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgYmFja2dyb3VuZENvbG9yID0gZ2V0Q29sb3JGcm9tQmFja2dyb3VuZE9wdGlvbnMob3B0cy5iYWNrZ3JvdW5kKVxuXG4gIGNvbnN0IHJlbmRlck9wdGlvbnM6IFJlbmRlclNjZW5lT3B0aW9ucyA9IHtcbiAgICBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgc2hvd0dyaWQ6IG9wdHMuc2hvd0dyaWQgPz8gZmFsc2UsXG4gICAgc2hvd09yaWdpbjogb3B0cy5zaG93T3JpZ2luID8/IGZhbHNlLFxuICAgIHNob3dBeGVzOiBvcHRzLnNob3dBeGVzID8/IGZhbHNlLFxuICB9XG5cbiAgaWYgKG9wdHMud2lkdGgpIHJlbmRlck9wdGlvbnMud2lkdGggPSBvcHRzLndpZHRoXG4gIGlmIChvcHRzLmhlaWdodCkgcmVuZGVyT3B0aW9ucy5oZWlnaHQgPSBvcHRzLmhlaWdodFxuXG4gIGNvbnN0IHNjZW5lID0gYXdhaXQgY29udmVydENpcmN1aXRKc29uVG9TaW1wbGUzZFNjZW5lKGNpcmN1aXRKc29uLCBvcHRzKVxuXG4gIHJldHVybiBhd2FpdCByZW5kZXJTY2VuZShzY2VuZSwge1xuICAgIC4uLnJlbmRlck9wdGlvbnMsXG4gIH0pXG59XG5cbmV4cG9ydCB0eXBlIHsgU2ltcGxlM2RTdmdPcHRpb25zLCBCYWNrZ3JvdW5kT3B0aW9ucywgQW5nbGVQcmVzZXQgfVxuIiwgImltcG9ydCB0eXBlIHsgUGNiQm9hcmQsIFBvaW50MyB9IGZyb20gXCJjaXJjdWl0LWpzb25cIlxuaW1wb3J0IHR5cGUgeyBDYW1lcmEgfSBmcm9tIFwiQHRzY2lyY3VpdC9zaW1wbGUtM2Qtc3ZnXCJcblxuZXhwb3J0IHR5cGUgQW5nbGVQcmVzZXQgPVxuICB8IFwiYW5nbGUxXCJcbiAgfCBcImFuZ2xlMlwiXG4gIHwgXCJsZWZ0XCJcbiAgfCBcInJpZ2h0XCJcbiAgfCBcImxlZnQtcmFpc2VkXCJcbiAgfCBcInJpZ2h0LXJhaXNlZFwiXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q2FtZXJhRm9yUGNiQm9hcmQoXG4gIHBjYkJvYXJkOiBQY2JCb2FyZCxcbiAgYW5nbGVQcmVzZXQ6IEFuZ2xlUHJlc2V0ID0gXCJhbmdsZTFcIixcbiAgZGVmYXVsdFpvb21NdWx0aXBsaWVyPzogbnVtYmVyLFxuKTogQ2FtZXJhIHtcbiAgY29uc3QgdyA9IHBjYkJvYXJkLndpZHRoXG4gIGNvbnN0IGggPSBwY2JCb2FyZC5oZWlnaHRcblxuICBjb25zdCBjeCA9IHBjYkJvYXJkLmNlbnRlcj8ueCB8fCAwXG4gIGNvbnN0IGN6ID0gcGNiQm9hcmQuY2VudGVyPy55IHx8IDBcblxuICBjb25zdCBib2FyZFNpemUgPSBNYXRoLm1heCh3LCBoKVxuICBsZXQgYmFzZURpc3QgPSBib2FyZFNpemUgKiAxLjVcbiAgbGV0IGVmZmVjdGl2ZVpvb21MZXZlbDogbnVtYmVyIHwgdW5kZWZpbmVkXG5cbiAgaWYgKGRlZmF1bHRab29tTXVsdGlwbGllciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKGRlZmF1bHRab29tTXVsdGlwbGllciA+IDApIHtcbiAgICAgIGVmZmVjdGl2ZVpvb21MZXZlbCA9IGRlZmF1bHRab29tTXVsdGlwbGllclxuICAgICAgYmFzZURpc3QgPSBiYXNlRGlzdCAvIGVmZmVjdGl2ZVpvb21MZXZlbFxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGRpc3QgPSBiYXNlRGlzdFxuXG4gIGxldCBwb3NpdGlvbjogUG9pbnQzXG4gIGlmIChhbmdsZVByZXNldCA9PT0gXCJhbmdsZTFcIikge1xuICAgIHBvc2l0aW9uID0geyB4OiBjeCAtIGRpc3QsIHk6IGRpc3QsIHo6IGN6IC0gZGlzdCB9XG4gIH0gZWxzZSBpZiAoYW5nbGVQcmVzZXQgPT09IFwiYW5nbGUyXCIpIHtcbiAgICBwb3NpdGlvbiA9IHsgeDogY3ggKyBkaXN0LCB5OiBkaXN0LCB6OiBjeiAtIGRpc3QgfVxuICB9IGVsc2UgaWYgKGFuZ2xlUHJlc2V0ID09PSBcImxlZnRcIikge1xuICAgIHBvc2l0aW9uID0geyB4OiBjeCAtIGRpc3QsIHk6IDAsIHo6IGN6IH1cbiAgfSBlbHNlIGlmIChhbmdsZVByZXNldCA9PT0gXCJyaWdodFwiKSB7XG4gICAgcG9zaXRpb24gPSB7IHg6IGN4ICsgZGlzdCwgeTogMCwgejogY3ogfVxuICB9IGVsc2UgaWYgKGFuZ2xlUHJlc2V0ID09PSBcImxlZnQtcmFpc2VkXCIpIHtcbiAgICBwb3NpdGlvbiA9IHsgeDogY3ggLSBkaXN0LCB5OiBkaXN0LCB6OiBjeiB9XG4gIH0gZWxzZSBpZiAoYW5nbGVQcmVzZXQgPT09IFwicmlnaHQtcmFpc2VkXCIpIHtcbiAgICBwb3NpdGlvbiA9IHsgeDogY3ggKyBkaXN0LCB5OiBkaXN0LCB6OiBjeiB9XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGFuZ2xlIHByZXNldDogJHthbmdsZVByZXNldH1gKVxuICB9XG5cbiAgY29uc3QgZm9jYWxMZW5ndGggPSBlZmZlY3RpdmVab29tTGV2ZWxcbiAgICA/IE1hdGgubWF4KDEsIDIgKiBlZmZlY3RpdmVab29tTGV2ZWwpXG4gICAgOiAyXG5cbiAgcmV0dXJuIHtcbiAgICBwb3NpdGlvbixcbiAgICBsb29rQXQ6IHsgeDogY3gsIHk6IDAsIHo6IGN6IH0sXG4gICAgZm9jYWxMZW5ndGgsXG4gIH1cbn1cbiIsICJpbXBvcnQgdHlwZSB7IFBjYkNvbXBvbmVudCwgUG9pbnQzIH0gZnJvbSBcImNpcmN1aXQtanNvblwiXG5pbXBvcnQgdHlwZSB7IENhbWVyYSB9IGZyb20gXCJAdHNjaXJjdWl0L3NpbXBsZS0zZC1zdmdcIlxuaW1wb3J0IHR5cGUgeyBBbmdsZVByZXNldCB9IGZyb20gXCIuL2dldERlZmF1bHRDYW1lcmFGb3JQY2JCb2FyZFwiXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q2FtZXJhRm9yQ29tcG9uZW50cyhcbiAgY29tcG9uZW50czogUGNiQ29tcG9uZW50W10sXG4gIGFuZ2xlUHJlc2V0OiBBbmdsZVByZXNldCA9IFwiYW5nbGUxXCIsXG4gIGRlZmF1bHRab29tTXVsdGlwbGllcj86IG51bWJlcixcbik6IENhbWVyYSB7XG4gIGlmIChjb21wb25lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIC8vIERlZmF1bHQgZmFsbGJhY2sgY2FtZXJhIGZvciBlbXB0eSBjb21wb25lbnQgbGlzdFxuICAgIHJldHVybiB7XG4gICAgICBwb3NpdGlvbjogeyB4OiAxMCwgeTogMTAsIHo6IDEwIH0sXG4gICAgICBsb29rQXQ6IHsgeDogMCwgeTogMCwgejogMCB9LFxuICAgICAgZm9jYWxMZW5ndGg6IDIsXG4gICAgfVxuICB9XG5cbiAgLy8gQ2FsY3VsYXRlIGJvdW5kaW5nIGJveCBvZiBhbGwgY29tcG9uZW50c1xuICBsZXQgbWluWCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWVxuICBsZXQgbWF4WCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWVxuICBsZXQgbWluWiA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWVxuICBsZXQgbWF4WiA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWVxuXG4gIGZvciAoY29uc3QgY29tcCBvZiBjb21wb25lbnRzKSB7XG4gICAgY29uc3QgaGFsZldpZHRoID0gY29tcC53aWR0aCAvIDJcbiAgICBjb25zdCBoYWxmSGVpZ2h0ID0gY29tcC5oZWlnaHQgLyAyXG5cbiAgICBtaW5YID0gTWF0aC5taW4obWluWCwgY29tcC5jZW50ZXIueCAtIGhhbGZXaWR0aClcbiAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgY29tcC5jZW50ZXIueCArIGhhbGZXaWR0aClcbiAgICBtaW5aID0gTWF0aC5taW4obWluWiwgY29tcC5jZW50ZXIueSAtIGhhbGZIZWlnaHQpXG4gICAgbWF4WiA9IE1hdGgubWF4KG1heFosIGNvbXAuY2VudGVyLnkgKyBoYWxmSGVpZ2h0KVxuICB9XG5cbiAgLy8gQ2FsY3VsYXRlIGNlbnRlciBhbmQgc2l6ZSBvZiBjb21wb25lbnRzXG4gIGNvbnN0IGN4ID0gKG1pblggKyBtYXhYKSAvIDJcbiAgY29uc3QgY3ogPSAobWluWiArIG1heFopIC8gMlxuICBjb25zdCB3ID0gbWF4WCAtIG1pblhcbiAgY29uc3QgaCA9IG1heFogLSBtaW5aXG5cbiAgY29uc3QgY29tcG9uZW50U2l6ZSA9IE1hdGgubWF4KHcsIGgsIDUpIC8vIE1pbmltdW0gc2l6ZSBvZiA1IHRvIHByZXZlbnQgdG9vIGNsb3NlIGNhbWVyYVxuICBsZXQgYmFzZURpc3QgPSBjb21wb25lbnRTaXplICogMS41XG4gIGxldCBlZmZlY3RpdmVab29tTGV2ZWw6IG51bWJlciB8IHVuZGVmaW5lZFxuXG4gIGlmIChkZWZhdWx0Wm9vbU11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChkZWZhdWx0Wm9vbU11bHRpcGxpZXIgPiAwKSB7XG4gICAgICBlZmZlY3RpdmVab29tTGV2ZWwgPSBkZWZhdWx0Wm9vbU11bHRpcGxpZXJcbiAgICAgIGJhc2VEaXN0ID0gYmFzZURpc3QgLyBlZmZlY3RpdmVab29tTGV2ZWxcbiAgICB9XG4gIH1cblxuICBjb25zdCBkaXN0ID0gYmFzZURpc3RcblxuICBsZXQgcG9zaXRpb246IFBvaW50M1xuICBpZiAoYW5nbGVQcmVzZXQgPT09IFwiYW5nbGUxXCIpIHtcbiAgICBwb3NpdGlvbiA9IHsgeDogY3ggLSBkaXN0LCB5OiBkaXN0LCB6OiBjeiAtIGRpc3QgfVxuICB9IGVsc2UgaWYgKGFuZ2xlUHJlc2V0ID09PSBcImFuZ2xlMlwiKSB7XG4gICAgcG9zaXRpb24gPSB7IHg6IGN4ICsgZGlzdCwgeTogZGlzdCwgejogY3ogLSBkaXN0IH1cbiAgfSBlbHNlIGlmIChhbmdsZVByZXNldCA9PT0gXCJsZWZ0XCIpIHtcbiAgICBwb3NpdGlvbiA9IHsgeDogY3ggLSBkaXN0LCB5OiAwLCB6OiBjeiB9XG4gIH0gZWxzZSBpZiAoYW5nbGVQcmVzZXQgPT09IFwicmlnaHRcIikge1xuICAgIHBvc2l0aW9uID0geyB4OiBjeCArIGRpc3QsIHk6IDAsIHo6IGN6IH1cbiAgfSBlbHNlIGlmIChhbmdsZVByZXNldCA9PT0gXCJsZWZ0LXJhaXNlZFwiKSB7XG4gICAgcG9zaXRpb24gPSB7IHg6IGN4IC0gZGlzdCwgeTogZGlzdCwgejogY3ogfVxuICB9IGVsc2UgaWYgKGFuZ2xlUHJlc2V0ID09PSBcInJpZ2h0LXJhaXNlZFwiKSB7XG4gICAgcG9zaXRpb24gPSB7IHg6IGN4ICsgZGlzdCwgeTogZGlzdCwgejogY3ogfVxuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBhbmdsZSBwcmVzZXQ6ICR7YW5nbGVQcmVzZXR9YClcbiAgfVxuXG4gIGNvbnN0IGZvY2FsTGVuZ3RoID0gZWZmZWN0aXZlWm9vbUxldmVsXG4gICAgPyBNYXRoLm1heCgxLCAyICogZWZmZWN0aXZlWm9vbUxldmVsKVxuICAgIDogMlxuXG4gIHJldHVybiB7XG4gICAgcG9zaXRpb24sXG4gICAgbG9va0F0OiB7IHg6IGN4LCB5OiAwLCB6OiBjeiB9LFxuICAgIGZvY2FsTGVuZ3RoLFxuICB9XG59XG4iLCAiaW1wb3J0IENvbG9yIGZyb20gXCJjb2xvclwiXG5pbXBvcnQgdHlwZSB7IEJhY2tncm91bmRPcHRpb25zIH0gZnJvbSBcIi4uL3R5cGVzXCJcbmltcG9ydCB7IGlzVmFsaWRDb2xvciB9IGZyb20gXCIuL2lzLXZhbGlkLWNvbG9yXCJcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbG9yRnJvbUJhY2tncm91bmRPcHRpb25zKFxuICBiYWNrZ3JvdW5kPzogQmFja2dyb3VuZE9wdGlvbnMsXG4pOiBzdHJpbmcge1xuICBpZiAoIWJhY2tncm91bmQpIHJldHVybiBcIndoaXRlXCJcblxuICBpZiAoYmFja2dyb3VuZC5jb2xvcikge1xuICAgIGlmIChiYWNrZ3JvdW5kLm9wYWNpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29sb3IgPSBDb2xvcihiYWNrZ3JvdW5kLmNvbG9yKVxuICAgICAgICBjb25zdCBvcGFjaXR5ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgYmFja2dyb3VuZC5vcGFjaXR5KSlcbiAgICAgICAgcmV0dXJuIGNvbG9yLmFscGhhKG9wYWNpdHkpLnN0cmluZygpXG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIFwid2hpdGVcIlxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1ZhbGlkQ29sb3IoYmFja2dyb3VuZC5jb2xvcikpIHtcbiAgICAgIHJldHVybiBiYWNrZ3JvdW5kLmNvbG9yXG4gICAgfVxuXG4gICAgcmV0dXJuIFwid2hpdGVcIlxuICB9XG5cbiAgcmV0dXJuIFwid2hpdGVcIlxufVxuIiwgImltcG9ydCBDb2xvciBmcm9tIFwiY29sb3JcIlxuXG5leHBvcnQgY29uc3QgaXNWYWxpZENvbG9yID0gKGNvbG9yOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgdHJ5IHtcbiAgICBDb2xvcihjb2xvcilcbiAgICByZXR1cm4gdHJ1ZVxuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUVBLFNBQVMsV0FBVztBQUNwQixTQUFTLG1CQUEwQzs7O0FDUTVDLFNBQVMsNEJBQ2QsVUFDQSxjQUEyQixVQUMzQix1QkFDUTtBQUNSLFFBQU0sSUFBSSxTQUFTO0FBQ25CLFFBQU0sSUFBSSxTQUFTO0FBRW5CLFFBQU0sS0FBSyxTQUFTLFFBQVEsS0FBSztBQUNqQyxRQUFNLEtBQUssU0FBUyxRQUFRLEtBQUs7QUFFakMsUUFBTSxZQUFZLEtBQUssSUFBSSxHQUFHLENBQUM7QUFDL0IsTUFBSSxXQUFXLFlBQVk7QUFDM0IsTUFBSTtBQUVKLE1BQUksMEJBQTBCLFFBQVc7QUFDdkMsUUFBSSx3QkFBd0IsR0FBRztBQUM3QiwyQkFBcUI7QUFDckIsaUJBQVcsV0FBVztBQUFBLElBQ3hCO0FBQUEsRUFDRjtBQUVBLFFBQU0sT0FBTztBQUViLE1BQUk7QUFDSixNQUFJLGdCQUFnQixVQUFVO0FBQzVCLGVBQVcsRUFBRSxHQUFHLEtBQUssTUFBTSxHQUFHLE1BQU0sR0FBRyxLQUFLLEtBQUs7QUFBQSxFQUNuRCxXQUFXLGdCQUFnQixVQUFVO0FBQ25DLGVBQVcsRUFBRSxHQUFHLEtBQUssTUFBTSxHQUFHLE1BQU0sR0FBRyxLQUFLLEtBQUs7QUFBQSxFQUNuRCxXQUFXLGdCQUFnQixRQUFRO0FBQ2pDLGVBQVcsRUFBRSxHQUFHLEtBQUssTUFBTSxHQUFHLEdBQUcsR0FBRyxHQUFHO0FBQUEsRUFDekMsV0FBVyxnQkFBZ0IsU0FBUztBQUNsQyxlQUFXLEVBQUUsR0FBRyxLQUFLLE1BQU0sR0FBRyxHQUFHLEdBQUcsR0FBRztBQUFBLEVBQ3pDLFdBQVcsZ0JBQWdCLGVBQWU7QUFDeEMsZUFBVyxFQUFFLEdBQUcsS0FBSyxNQUFNLEdBQUcsTUFB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O0FBQUEsTUFDZDtBQUFBLE1BQ0EsWUFBWTtBQUFBLFFBQ1YsS0FBSyw2QkFBNkIsS0FBSyxTQUFTLENBQUM7QUFBQSxNQUNuRDtBQUFBLE1BQ0EsdUJBQXVCO0FBQUEsTUFDdkIsT0FBTztBQUFBLElBQ1QsQ0FBQztBQUFBLEVBQ0g7QUFFQSxhQUFXLFFBQVEsR0FBRyxjQUFjLEtBQUssR0FBRztBQUMxQyxRQUFJLHNCQUFzQixJQUFJLEtBQUssZ0JBQWdCLEVBQUc7QUFDdEQsVUFBTSxrQkFBa0IsR0FBRyxpQkFBaUIsSUFBSSxLQUFLLG1CQUFtQjtBQUN4RSxVQUFNLGFBQWEsS0FBSztBQUFBLE1BQ3RCLEtBQUssSUFBSSxLQUFLLE9BQU8sS0FBSyxNQUFNO0FBQUEsTUFDaEM7QUFBQSxJQUNGO0FBQ0EsVUFBTSxpQkFBaUIsVUFBVSxhQUFhO0FBQzlDLFVBQU0sS0FBSztBQUFBLE1BQ1QsUUFBUTtBQUFBLFFBQ04sR0FBRyxLQUFLLE9BQU87QUFBQSxRQUNmLEdBQUcsaUJBQWlCLElBQUksYUFBYTtBQUFBLFFBQ3JDLEdBQUcsS0FBSyxPQUFPO0FBQUEsTUFDakI7QUFBQSxNQUNBLE1BQU07QUFBQSxRQUNKLEdBQUcsS0FBSztBQUFBLFFBQ1IsR0FBRztBQUFBLFFBQ0gsR0FBRyxLQUFLO0FBQUEsTUFDVjtBQUFBLE1BQ0EsT0FBTztBQUFBLE1BQ1AsVUFBVSxpQkFBaUIsUUFBUTtBQUFBLE1BQ25DLGVBQWU7QUFBQSxJQUNqQixDQUFDO0FBQUEsRUFDSDtBQUVBLFNBQU8sRUFBRSxPQUFPLE9BQU87QUFDekI7QUFFQSxlQUFzQixnQ0FDcEIsYUFDQSxPQUEyQixDQUFDLEdBQ1g7QUFDakIsUUFBTSxrQkFBa0IsOEJBQThCLEtBQUssVUFBVTtBQUVyRSxRQUFNLGdCQUFvQztBQUFBLElBQ3hDO0FBQUEsSUFDQSxVQUFVLEtBQUssWUFBWTtBQUFBLElBQzNCLFlBQVksS0FBSyxjQUFjO0FBQUEsSUFDL0IsVUFBVSxLQUFLLFlBQVk7QUFBQSxFQUM3QjtBQUVBLE1BQUksS0FBSyxNQUFPLGVBQWMsUUFBUSxLQUFLO0FBQzNDLE1BQUksS0FBSyxPQUFRLGVBQWMsU0FBUyxLQUFLO0FBRTdDLFFBQU0sUUFBUSxNQUFNLGtDQUFrQyxhQUFhLElBQUk7QUFFdkUsU0FBTyxNQUFNLFlBQVksT0FBTztBQUFBLElBQzlCLEdBQUc7QUFBQSxFQUNMLENBQUM7QUFDSDsiLAogICJuYW1lcyI6IFsiQ29sb3IiLCAiQ29sb3IiXQp9Cg==